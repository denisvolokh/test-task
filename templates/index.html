<html>
  <head>
    <title>Search</title>
  </head>
  <body>
    <h1>Search</h1>
    <form>
      <p>Search for: <input style="width: 600px;" type="text" name="search" value="authors(journals='https://cos.io/top/', publications='https://www.ncbi.nlm.nih.gov/', year=2016)"></p>
      <input type="submit" name="submit" value="Search">
    </form>
    <hr>
    <div id="results"></div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
        $(document).ready(function() {

            $('form').submit(function(event) {

                var formData = {
                    'search' : $('input[name=search]').val()
                };

                $.post("/api/search", formData, function(data) {

                    console.log(data);
                    var task_id = data["task_id"];

                    update_search_progress(task_id);

                }, "json").fail(function(error) {

                    console.log(error)

                })

                event.preventDefault();
            });

            var update_search_progress = function(task_id) {

                $.get("/api/search/status/" + task_id, function(data) {

                    console.log("updates >>>", data);

                    if (data["state"] != "SUCCESS") {

                        setTimeout(function() {
                            update_search_progress(task_id);
                        }, 2000);

                    }



                }, "json").fail(function(error) {

                    console.log(error)

                })

            }

        });
    </script>
  </body>
</html>
